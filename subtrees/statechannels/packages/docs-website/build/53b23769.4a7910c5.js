(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{182:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return i})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return u}));var a=n(2),o=n(6),r=(n(0),n(420)),c={id:"outcomes",title:"Understand Outcomes"},i={unversionedId:"protocol-tutorial/outcomes",id:"protocol-tutorial/outcomes",isDocsHomePage:!1,title:"Understand Outcomes",description:"So far during this tutorial we have not concerned ourselves with specifying meaningful outcomes on any of our States. This has meant that although we have learnt to deposit assets, execute state transitions off chain, and to finalize an outcome via challenge or conclude, no participant could get their funds back out of the state channel and into their ethereum account.",source:"@site/docs/protocol-tutorial/outcomes.md",permalink:"/protocol-tutorial/outcomes",lastUpdatedBy:"Caleb Ditchfield",lastUpdatedAt:1600126133,sidebar:"docs",previous:{title:"Clear a challenge",permalink:"/protocol-tutorial/clear-a-challenge"},next:{title:"Release assets",permalink:"/protocol-tutorial/release-assets"}},s=[{value:"Outcomes that allocate",id:"outcomes-that-allocate",children:[]},{value:"Outcomes that guarantee",id:"outcomes-that-guarantee",children:[]}],l={rightToc:s};function u(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"So far during this tutorial we have not concerned ourselves with specifying meaningful outcomes on any of our ",Object(r.b)("inlineCode",{parentName:"p"},"States"),". This has meant that although we have learnt to deposit assets, execute state transitions off chain, and to finalize an outcome via challenge or conclude, no participant could get their funds back out of the state channel and into their ethereum account."),Object(r.b)("p",null,"The time has come to tackle this issue!\nNitro protocol is an extension of ForceMove protocol that we have dealt with so far. ForceMove specifies only that a state should have a default ",Object(r.b)("inlineCode",{parentName:"p"},"outcome")," but does not specify the format of that ",Object(r.b)("inlineCode",{parentName:"p"},"outcome"),", and simply treats it as an unstructured ",Object(r.b)("inlineCode",{parentName:"p"},"bytes")," field. In this section we look at the outcome formats needed for Nitro."),Object(r.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"tip")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"Nitro supports multiple different assets (e.g. ETH and one or more ERC20s) being held in the same channel."))),Object(r.b)("h2",{id:"outcomes-that-allocate"},"Outcomes that allocate"),Object(r.b)("p",null,"An Allocation outcome specifies"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"at least one asset holder (which in turn is tied to a specific asset type such as ETH or an ERC20 token)"),Object(r.b)("li",{parentName:"ul"},"for each asset holder, an array of (destination, amount) pairs known as an ",Object(r.b)("inlineCode",{parentName:"li"},"Allocation"),", and indicating a payout of amount tokens to destination.")),Object(r.b)("p",null,"The destination here might be an external destination (which means the assets will get paid out to an ethereum address) or a channelId. In the code snippet below, we import ",Object(r.b)("inlineCode",{parentName:"p"},"convertAddressToBytes32")," to convert an ethereum address to an external destination."),Object(r.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"tip")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"In nitro protocol, channels can allocate funds to other channels!"))),Object(r.b)("p",null,"To construct an outcome, you can import the ",Object(r.b)("inlineCode",{parentName:"p"},"Outcome")," type to ensure you're getting the basics right. Then go ahead and attach that outcome in place of the ",Object(r.b)("inlineCode",{parentName:"p"},"[]")," we used as a placeholder previously on our ",Object(r.b)("inlineCode",{parentName:"p"},"States"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),"// In lesson11.test.ts\n\nimport {\n  AllocationAssetOutcome,\n  Outcome,\n  encodeOutcome,\n  decodeOutcome,\n  convertAddressToBytes32\n  } from '@statechannels/nitro-protocol';\n\nconst externalDestination(convertAddressToBytes32(AddressZero));\n\nconst assetOutcome: AllocationAssetOutcome = {\n  assetHolderAddress: ETH_ASSET_HOLDER_ADDRESS\n  allocationItems: [\n    {destination: externalDestination, amount: '0x03'}, // 3 wei\n    // other payouts go here,\n    // e.g. having destination: someOtherExternalDestintion\n    // or destination: someChannelId\n  ],\n};\n\nconst outcome: Outcome = [assetOutcome];\n// Additional assetOutcomes could be pushed into this array\n\n// Optional: this encoding function is a part of the getVariablePart helper function that we are already using\n// So you most likely won't need to use it.\nconst encodedOutcome = encodeOutcome(outcome);\nexpect(decodeOutcome(encodedOutcome)).toEqual(outcome);\n")),Object(r.b)("h2",{id:"outcomes-that-guarantee"},"Outcomes that guarantee"),Object(r.b)("p",null,"Guarantee Asset Outcomes are similar to Allocation Asset Outcomes, only they not have any amounts. Their purpose is to simply express an ordering of destinations for a given asset holder (say, a given token)."),Object(r.b)("p",null,"A channel that has a guarantee outcome is said to be a guarantor channel."),Object(r.b)("p",null,"Now while we can ",Object(r.b)("em",{parentName:"p"},"transfer")," assets out of a channel, the terminology is instead to ",Object(r.b)("em",{parentName:"p"},"claim")," on a guarantor channel. Assets will be paid to beneficiaries of the ",Object(r.b)("em",{parentName:"p"},"target")," channel, but in an order of precedence defined by the guarantor. More on this later."),Object(r.b)("p",null,"Constructing the right kind of object in typescript is straightforward:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),"// In lesson12.test.ts\n\nimport {GuaranteeAssetOutcome} from '@statechannels/nitro-protocol';\n\nconst assetOutcome: GuaranteeAssetOutcome = {\n  assetHolderAddress: process.env.ETH_ASSET_HOLDER_ADDRESS,\n  guarantee: {\n    targetChannelId: HashZero,\n    destinations: [\n      '0x000000000000000000000000000000000000000000000000000000000000000b',\n      '0x000000000000000000000000000000000000000000000000000000000000000a',\n    ],\n  },\n};\n")),Object(r.b)("p",null,"Encoding of all outcomes (including guarantee outcomes) is handled seamlessly by the ",Object(r.b)("inlineCode",{parentName:"p"},"getVariablePart")," function."),Object(r.b)("p",null,"Don't worry if it is not yet clear why we need guarantor channels or outcomes that guarantee. They are a useful tool for virtually funding channels, but can be safely ignored if you are just trying to understand directly funded channels."))}u.isMDXComponent=!0},420:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return h}));var a=n(0),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=o.a.createContext({}),u=function(e){var t=o.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=u(e.components);return o.a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},m=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),d=u(n),m=a,h=d["".concat(c,".").concat(m)]||d[m]||p[m]||r;return n?o.a.createElement(h,i(i({ref:t},l),{},{components:n})):o.a.createElement(h,i({ref:t},l))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,c=new Array(r);c[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,c[1]=i;for(var l=2;l<r;l++)c[l]=n[l];return o.a.createElement.apply(null,c)}return o.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);