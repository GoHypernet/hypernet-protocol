<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.59">
<link rel="search" type="application/opensearchdescription+xml" title="statechannels docs" href="/opensearch.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Chivo&display=swap">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css">
<script src="https://buttons.github.io/buttons.js"></script><title data-react-helmet="true">Quick start (contracts) | statechannels docs</title><meta data-react-helmet="true" property="og:image" content="https://docs.statechannels.org/img/undraw_online.svg"><meta data-react-helmet="true" property="twitter:image" content="https://docs.statechannels.org/img/undraw_online.svg"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for statechannels docs"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Quick start (contracts) | statechannels docs"><meta data-react-helmet="true" name="description" content="You should begin your application design process by creating a single smart contract conforming to the ForceMoveApp interface."><meta data-react-helmet="true" property="og:description" content="You should begin your application design process by creating a single smart contract conforming to the ForceMoveApp interface."><meta data-react-helmet="true" property="og:url" content="https://docs.statechannels.org/app-devs/quick-start-contracts"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://docs.statechannels.org/app-devs/quick-start-contracts"><link rel="stylesheet" href="/styles.e0b33fa7.css">
<link rel="preload" href="/styles.8e0db825.js" as="script">
<link rel="preload" href="/runtime~main.27671965.js" as="script">
<link rel="preload" href="/main.03452097.js" as="script">
<link rel="preload" href="/2.4ee922d7.js" as="script">
<link rel="preload" href="/3.4c7fc1f6.js" as="script">
<link rel="preload" href="/4.a5988223.js" as="script">
<link rel="preload" href="/1be78505.75ec5049.js" as="script">
<link rel="preload" href="/369.23cc9095.js" as="script">
<link rel="preload" href="/ec1ed54d.db84b9ba.js" as="script">
<link rel="preload" href="/17896441.61fde53e.js" as="script">
<link rel="preload" href="/1.12d0c272.js" as="script">
<link rel="preload" href="/e556ee4c.67534374.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg"><strong class="navbar__title">statechannels docs</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a class="navbar__item navbar__link" href="/typescript-api/index">Typescript API</a><a class="navbar__item navbar__link" href="/contract-api/contract-inheritance">Contract API</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg"><strong class="navbar__title">statechannels docs</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/typescript-api/index">Typescript API</a></li><li class="menu__list-item"><a class="menu__link" href="/contract-api/contract-inheritance">Contract API</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Overview</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/">statechannels docs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/products">Our products</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">App Developers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/app-devs/app-devs-intro">Introduction</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/app-devs/quick-start-contracts">Quick start (contracts)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/app-devs/quick-start-dapp">Quick start (Dapp)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/app-devs/hook-up-messaging">Hook up your messaging layer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/app-devs/make-api-calls">Make Wallet API calls</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/app-devs/recommended-patterns">Recommended patterns</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Protocol Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/protocol-docs/wallet-devs-intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/protocol-docs/quick-start">Quick Start</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/protocol-docs/tutorial">Tutorial</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Protocol Tutorial</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/protocol-tutorial/execute-state-transitions">Execute state transitions off chain</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/protocol-tutorial/deposit-assets">Deposit Assets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/protocol-tutorial/finalize-a-channel-happy">Finalize a channel (happy)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/protocol-tutorial/finalize-a-channel-sad">Finalize a channel (sad)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/protocol-tutorial/understand-channel-storage">Understand channel storage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/protocol-tutorial/clear-a-challenge">Clear a challenge</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/protocol-tutorial/outcomes">Understand Outcomes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/protocol-tutorial/release-assets">Release assets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/protocol-tutorial/off-chain-funding">Off-chain funding</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Implementation Notes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/implementation-notes/contract-devs-intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/implementation-notes/asset-holder">AssetHolder.sol</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/implementation-notes/force-move">ForceMove.sol</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/implementation-notes/nitro-adjudicator">NitroAdjudicator.sol</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/implementation-notes/null-app">Null app</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/implementation-notes/single-asset-payments">SingleAssetPayments.sol</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Quick start (contracts)</h1></header><div class="markdown"><p>You should begin your application design process by creating a single smart contract conforming to the <a href="/../contract-api/natspec/ForceMoveApp"><code>ForceMoveApp</code></a> interface.</p><p>You&#x27;ll want to pull this interface, as well as the <code>Outcome</code> library contract, into your project using your favourite node package manager:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-console codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="token plain">&gt; yarn add @statechannels/nitro-protocol</span></div></div></div></div></div><p>The <code>ForceMoveApp</code> interface calls for an application-specific <code>validTransition(a,b)</code> function. This function needs to decode the <code>appData</code>, from state channel updates <code>a</code> and <code>b</code>, and decide if <code>b</code> is an acceptable transition from <code>a</code>. For example, in a game of chess, the position of the king in <code>b.appData</code> must be within one square of its position in <code>a.appData</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="examples"></a>Examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#examples" title="Direct link to heading">#</a></h2><p>For example, one can implement a simple counting application, where the stae of the channel can only be updated by incrementing a counter variable:</p><p>In <code>/contracts/CountingApp.sol</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-solidity codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="token plain">pragma solidity ^0.6.0;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">pragma experimental ABIEncoderV2;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">import &#x27;@statechannels/nitro-protocol/contracts/interfaces/ForceMoveApp.sol&#x27;;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">import &#x27;@statechannels/nitro-protocol/contracts/Outcome.sol&#x27;;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">contract CountingApp is ForceMoveApp {</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  struct CountingAppData {</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    uint256 counter;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  }</span></div><div class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  function appData(bytes memory appDataBytes) internal pure returns (CountingAppData memory) {</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    return abi.decode(appDataBytes, (CountingAppData));</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  }</span></div><div class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  function validTransition(</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    VariablePart memory a,</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    VariablePart memory b,</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    uint256 turnNumB,</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    uint256 nParticipants</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  ) public pure override returns (bool) {</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    require(</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">      appData(b.appData).counter == appData(a.appData).counter + 1,</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">      &#x27;CountingApp: Counter must be incremented&#x27;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    );</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    require(keccak256(b.outcome) == keccak256(a.outcome), &#x27;CountingApp: Outcome must not change&#x27;);</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    return true;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  }</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">}</span></div></div></div></div></div><p>This example is unrepresentative, however, in that it does not allow any changes to the <code>outcome</code> of the channel. This means nothing of any value can change hands as the application is executed. A full ForceMoveApp should specify how the outcome is allowed to change during a transition: for example, if a chess player achieves checkmate, they might be permitted to claim all of the money in the channel.</p><p>More realistic ForceMoveApp examples exist: such as games of <a href="https://github.com/statechannels/apps/blob/master/packages/rps/contracts/RockPaperScissors.sol" target="_blank" rel="noopener noreferrer">Rock Paper Scissors</a> and <a href="https://github.com/statechannels/apps/blob/master/packages/tic-tac-toe/contracts/TicTacToe.sol" target="_blank" rel="noopener noreferrer">Tic Tac Toe</a>, as well as a simple <a href="/../implementation-notes/single-asset-payments">Payment Channel</a> app.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="design-guide"></a>Design guide<a aria-hidden="true" tabindex="-1" class="hash-link" href="#design-guide" title="Direct link to heading">#</a></h2><p>In more complicated applications, it can help to adopt a <a href="https://en.wikipedia.org/wiki/Finite-state_machine" target="_blank" rel="noopener noreferrer">finite state machine</a> model, which means the application can be represented in a digram such as this:</p><div class="mermaid" align="center">
stateDiagram-v2
[*] --&gt; Resting
Resting --&gt; Propose
Propose --&gt; Resting
Propose --&gt; Accept
Accept --&gt; Reveal
Reveal --&gt; Resting
</div><p>These finite states could be represented as a Solidity <a href="https://solidity.readthedocs.io/en/v0.6.0/types.html#enums" target="_blank" rel="noopener noreferrer"><code>enum</code></a>. In ForceMove, the participants &quot;leapfrog&quot; each other on this diagram, i.e.:</p><ul><li>A starts at Resting</li><li>B transitions to Propose</li><li>A transitions to Accept</li><li>B transitions to Reveal</li><li>repeat</li></ul><p>The <code>validTransition</code> function returns <code>true</code> only if the transition is one allowed by the arrows in the diagram (this is necessary but not sufficient, there are of course other checks made, too). On the other hand, Accept --&gt; Propose is not allowed, so <code>validTransition</code> could return <code>false</code> in this case.</p><p>In fact, to provide more information, it actually calls <code>revert(&#x27;No valid transition found&#x27;);</code>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-09-14T23:28:53.000Z" class="docLastUpdatedAt_217_">9/14/2020</time> by <strong>Caleb Ditchfield</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/app-devs/app-devs-intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/app-devs/quick-start-dapp"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Quick start (Dapp) Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3klQ"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#examples" class="table-of-contents__link">Examples</a></li><li><a href="#design-guide" class="table-of-contents__link">Design guide</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="text--center"><div class="margin-bottom--sm"><img class="footer__logo" src="/img/logo.svg"></div><div>Copyright Â© 2020</div></div></div></footer></div>
<script src="/styles.8e0db825.js"></script>
<script src="/runtime~main.27671965.js"></script>
<script src="/main.03452097.js"></script>
<script src="/2.4ee922d7.js"></script>
<script src="/3.4c7fc1f6.js"></script>
<script src="/4.a5988223.js"></script>
<script src="/1be78505.75ec5049.js"></script>
<script src="/369.23cc9095.js"></script>
<script src="/ec1ed54d.db84b9ba.js"></script>
<script src="/17896441.61fde53e.js"></script>
<script src="/1.12d0c272.js"></script>
<script src="/e556ee4c.67534374.js"></script>
</body>
</html>